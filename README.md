# 基于虚幻四引擎的物理场可视化仿真<br />
## 作者：许翔宇<br />
## 摘要<br />
随着各种仿真技术的成熟，仿真开销的不断降低，越来越多的数据处理项目开始使用仿真技术实现数字信息的可视化。仿真技术使得观测者能够更好的把握数据随着时间以及空间的改变量，揭示数据之间的联系。除此之外，视觉仿真技术逐渐开始被用于建筑设计、大型活动排练等项目中，减少这些项目在实地开发、演示、排练过程中的资源消耗。例如国庆70周年游行活动的彩排，让几万人同时在现场排练，要消耗大量的人力物力，使用数字仿真既可以节省资源、还可以提前预览方阵效果。<br />
随着技术的进步，可视化仿真的要求也越来越高、内容也越来越多。视觉仿真在整个项目中也越来越重要。本项目的研究目的主要是在UE4中实现物理场的可视化，探索在UE4引擎中可视化仿真可能性。主要成果如下：<br />
一是实现Comsol导出数据至UE4中。Comsol在生成导出物理场数据方面应用十分广泛，本项目进一步探索了Comsol导出的数据至UE4中的方法。使用Comsol中的App开发器定制了适合UE4读入的文件形式。<br />
二是UE4中可视化方法探索。除导出数据外，本项目还探索了几种可视化方法在UE4中的应用，如体绘制、颜色映射方法。在UE4中，使用程序化建模、样条曲线、指定位置生成Actor、材质球颜色控制等多个组件完成了可视化方法的具体实现。其中使用程序化建模完成体绘制方法、使用样条曲线表现流线是本文的创新点。此外，还实现了多个算法，例如颜色映射算法、归一化算法、材质球颜色通道控制、根据坐标生成型值点等。<br />
本设计所完成的系统已初步具有了物理场可视化的能力。可视化生成物理场的几个大方向：如何体绘制、如何表示矢量场、如何表示二维标量场等已经能够得到相对完善的结论。<br />
本文的第一个关键点，在于如何分配计算量。可视化生成物理场中的计算可以分为两大部分，一部分是物理计算，一部分是视觉计算。需要将这两部分计算各自分配到合适的软件中去。物理场相关的一定放在comsol中，视觉计算相关一定要放在UE4中，使其发挥所长。如果想在UE4中完成全部计算，不仅实现困难，而且会使效率变低，UE4的优势在于其视觉效果的多样性，这样一来反而会适得其反。<br />
第二个关键点，在于如何使用UE4自带的组件高效率地完成可视化方法的实现。场的可视化方法有体绘制、颜色映射等等，这些方法有着成熟的定义和思路。如何理解这些可视化方法的本质，再将其在UE4中完美地呈现出来，是一个非常值得探讨的问题。例如本文使用了UE4中的spline表示流线，使用procudural mesh完成体绘制，利用材质球顶点颜色传递顶点物理量等等，这些都是对UE4可视化数据的一种探索。<br />
本项目还很多不足，例如颜色映射算法，文中所用的颜色映射算法仅仅是四个线性方程的组合，透明度渐变算法也只是建立了一个与物理量大小挂钩的一次函数。由于笔者自身知识所限没能继续探索下去，但是颜色映射部分留出了接口，如果有更加复杂效果更好的颜色映射表，只需要改变函数。还有流线生成部分，型值点的绘制会占用大量的时间，25条流线需要绘制大约半分钟，目前也没有找到优化的方法。<br />
## 开发环境<br />
本设计的开发环境包括以下几个部分：<br />
处理器：Intel(R)Core(TM)i5-7500 CPU @ 3.40GHZ 3.40GHZ<br />
显示适配器：AMD Radeon RX 5700<br />
操作系统：Windows 10 企业版 <br />
操作系统版本：17134.1488<br />
系统类型：64位操作系统<br />
RAM:16.0GB<br />
UE4引擎版本：4.21<br />
Comsol版本：COMSOL Multiphysics 5.5<br />
在以上环境中，完成comsol耦合物理场计算求解需要大约6小时，完成comsol单物理场计算求解需要大约1小时。在UE4中绘制模型时间忽略不计，能够在分辨率1080P下60帧稳定运行系统。<br />
## 备注<br />
本github库只包含了UE4部分的代码，其中已经含有多个物理场计算得出的结果数据，在comsol中生成物理场的部分未被包含。
